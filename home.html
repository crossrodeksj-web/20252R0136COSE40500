<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>KU Yearbook - í™ˆ</title>
  <style>
    body {
      font-family: 'Noto Sans KR', sans-serif;
      background-color: #f4f6fa;
      margin: 0;
      padding: 0;
      color: #333;
    }

    /* ìƒë‹¨ë°” */
    .header {
      background-color: #7a0019;
      color: white;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 60px;
      border-bottom: 2px solid #5c0014;
      white-space: nowrap;
    }
    .header-left {
      display: flex;
      align-items: center;
      gap: 50px;
    }
    .logo {
      font-size: 24px;
      font-weight: 700;
      cursor: pointer;
    }
    .nav a {
      color: white;
      text-decoration: none;
      margin-right: 25px;
      font-weight: 500;
    }
    .logout-btn {
      background: transparent;
      color: white;
      border: 1px solid white;
      border-radius: 5px;
      padding: 4px 12px;
      font-size: 13px;
      cursor: pointer;
      width: auto;
      position: relative;
    }

    .container {
      display: flex;
      width: 95%;
      margin: 30px auto;
      gap: 40px;
    }

    /* ì¢Œì¸¡ í”„ë¡œí•„ ë°•ìŠ¤ */
    .profile-box {
      width: 260px;
      background: white;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 3px 12px rgba(0,0,0,0.1);
      text-align: center;
    }
    .profile-box img {
      width: 180px;
      height: 220px;
      border-radius: 8px;
      object-fit: cover;
      border: 1px solid #ddd;
    }

    .profile-box button {
      width: 100%;
      margin-top: 15px;
      padding: 12px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      color: white;
    }
    .edit-btn {
      background: #0052cc;
    }
    .upload-btn {
      background: #b3001b;
    }

    /* QOTD */
    .qotd-box {
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 3px 12px rgba(0,0,0,0.12);
      margin-bottom: 25px;
      width: 100%;
    }

    /* ì•¨ë²” ë°•ìŠ¤ */
    .album-box {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 3px 12px rgba(0,0,0,0.1);
      width: 100%;
    }

    .album-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(230px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .album-item {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.12);
      overflow: hidden;
      position: relative;
      padding-bottom: 10px;
    }

    .album-item img,
    .album-item video {
      width: 100%;
      height: 200px;
      object-fit: cover;
    }

    .meta {
      padding: 10px;
    }

    /* ì¢‹ì•„ìš” ë²„íŠ¼ */
    .like-btn {
      cursor: pointer;
      font-size: 22px;
      transition: transform .15s ease;
      user-select: none;
    }
    .like-btn:active {
      transform: scale(1.3);
    }

    /* ì˜ìƒ ì „ì²´ ë³´ê¸° íŒì—… */
    .popup-bg {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.6);
      justify-content: center;
      align-items: center;
      z-index: 900;
    }
    .popup-video {
      background: black;
      padding: 10px;
      border-radius: 12px;
    }

    /* ìˆ˜ì • íŒì—… */
    .edit-popup {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 25px;
      border-radius: 12px;
      width: 350px;
      box-shadow: 0 3px 14px rgba(0,0,0,0.25);
      z-index: 999;
    }
    .edit-popup input {
      width: 100%;
      margin-top: 10px;
      padding: 8px;
    }
  </style>
</head>

<body>

  <!-- ìƒë‹¨ë°” -->
  <div class="header">
    <div class="header-left">
      <div class="logo" onclick="location.href='home.html'">KU Yearbook</div>
      <div class="nav">
        <a href="home.html">ë‚´ í”„ë¡œí•„</a>
        <a href="search.html">ê²€ìƒ‰</a>
        <a href="dashboard.html">ëŒ€ì‹œë³´ë“œ</a>
      </div>
    </div>
    <button class="logout-btn" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
  </div>

  <div class="container">

    <!-- ğŸ”¹ğŸ”¹ ì¢Œì¸¡ í”„ë¡œí•„ ë°•ìŠ¤ (JSë¡œ ìë™ ì±„ì›€) -->
    <div class="profile-box" id="profileBox"></div>

    <!-- ğŸ”¹ğŸ”¹ ìš°ì¸¡ ë©”ì¸ -->
    <div style="flex:1">

    <!-- QOTD ë°•ìŠ¤ -->
    <div class="qotd-box" id="qotdBox">
      <span id="qotdText"></span>
      <input 
        id="qotdAnswer" 
        type="text" 
        placeholder="ì—¬ê¸°ì— ë‹µë³€ ì…ë ¥â€¦" 
        style="margin-left:15px; padding:6px; width:250px;"
      >
      <script>
      document.getElementById("qotdAnswer").addEventListener("change", function () {
          const answer = this.value.trim();
          if (!answer) return;

          const today = new Date().toISOString().split("T")[0];

          let qotdData = JSON.parse(localStorage.getItem("qotdAnswers") || "{}");

          qotdDã…“ata[today] = answer;

          localStorage.setItem("qotdAnswers", JSON.stringify(qotdData));
      });
      </script>

    </div>


    <!-- ë‚´ ì•¨ë²” -->
    <div class="album-box">
      <h2>ğŸ“¸ ë‚´ ì•¨ë²”</h2>
      <div class="album-grid" id="albumGrid"></div>
    </div>


    </div>
  </div>

  <!-- ì˜ìƒ íŒì—… -->
  <div class="popup-bg" id="videoPopup">
    <div class="popup-video">
      <video id="popupVideo" width="800" controls></video>
    </div>
  </div>

  <!-- ìˆ˜ì • íŒì—… -->
  <div class="edit-popup" id="editPopup">
    <h3>ì‚¬ì§„ ìˆ˜ì •</h3>
    <input type="text" id="editTitle" placeholder="ì œëª©">
    <input type="text" id="editPlace" placeholder="ì´¬ì˜ ì¥ì†Œ">
    <input type="text" id="editTags" placeholder="íƒœê·¸ (#ì˜ˆì‹œ)">
    <input type="file" id="editFile" accept="image/*,video/*">

    <button onclick="saveEdit()">ì €ì¥</button>
    <button onclick="closeEdit()">ì·¨ì†Œ</button>
  </div>

  <script>
    // ë¡œê·¸ì•„ì›ƒ
    function logout() {
      localStorage.removeItem("userProfile");
      location.href = "login.html";
    }

    /* ------------------------------
       QOTD í‘œì‹œ
    ------------------------------ */
    function loadQOTD() {
      const list = [
        "ì˜¤ëŠ˜ ì—¬í–‰ì„ ê°€ê³  ì‹¶ì€ ì¥ì†ŒëŠ”?",
        "ì˜¤ëŠ˜ ê°€ì¥ ë³´ê³  ì‹¶ì€ ì¹œêµ¬ëŠ”?",
        "ì˜¬í•´ ê°€ì¥ ê¸°ì–µì— ë‚¨ëŠ” ì¼ì€?"
      ];
      const q = list[Math.floor(Math.random() * list.length)];
      document.getElementById("qotdText").innerHTML = `<h3>ğŸ”¥ ì˜¤ëŠ˜ì˜ ì§ˆë¬¸</h3><p>${q}</p>`;

    }

    /* ------------------------------
       í”„ë¡œí•„ ë¡œë”©
    ------------------------------ */
    function loadProfileSummary() {
      const user = JSON.parse(localStorage.getItem("userProfile") || "{}");

      let html = "";

      html += `<img src="${user.photo || ""}" alt="í”„ë¡œí•„ ì‚¬ì§„">`;
      html += `<div style="margin-top:15px;">
                <strong>${user.name || ""}</strong><br>
                ${user.school || ""} ${user.department || ""}<br>
                ${user.grade || ""}<br><br>
                ${user.bio || ""}
              </div>`;

      html += `<button class="edit-btn" onclick="location.href='profile.html'">í”„ë¡œí•„ ìˆ˜ì •í•˜ê¸°</button>`;
      html += `<button class="upload-btn" onclick="location.href='upload.html'">ì—…ë¡œë“œ</button>`;

      document.getElementById("profileBox").innerHTML = html;
    }

    /* ------------------------------
       ì•¨ë²” ë¡œë”©
    ------------------------------ */
    let editIndex = -1;

    function loadAlbum() {
      const uploads = JSON.parse(localStorage.getItem("uploads") || "[]");
      const grid = document.getElementById("albumGrid");

      grid.innerHTML = "";

      uploads.forEach((item, index) => {
        let div = document.createElement("div");
        div.className = "album-item";

        // ë¯¸ë””ì–´
        if (item.type === "video") {
        div.innerHTML += `
            <video src="${item.url}" muted></video>
        `;
        } else {
          div.innerHTML += `
            <img src="${item.url}" onclick="openVideo('${item.url}')">
          `;
        }

        // ë©”íƒ€ ì •ë³´ + ì¢‹ì•„ìš” + ìˆ˜ì •/ì‚­ì œ
        div.innerHTML += `
          <div class="meta">
            <strong>${item.title || "ì œëª© ì—†ìŒ"}</strong><br>
            ${item.place || ""}<br>
            <span style="color:#555;">${(item.tags || []).map(t => "#"+t).join(" ")}</span>
            <div style="margin-top:8px; display:flex; justify-content:space-between; align-items:center;">

              <div style="display:flex; align-items:center; gap:6px;">
                <span class="like-btn" onclick="toggleLike(${index})">
                  ${item.liked ? "â¤ï¸" : "ğŸ¤"}
                </span>

                <span id="like-count-${index}" style="font-size:14px; color:#444;">
                  ${item.likes || 0}
                </span>
              </div>

              <div>
                <button onclick="readUpload(${index})" style="margin-right:5px;">ğŸ”Š</button>
                <button onclick="openEdit(${index})" style="margin-right:5px;">âœï¸</button>
                <button onclick="deleteItem(${index})">âŒ</button>
              </div>


            </div>

          </div>
        `;

        grid.appendChild(div);
      });
    }

    /* ------------------------------
       ì˜ìƒ ë³´ê¸° íŒì—…
    ------------------------------ */
    function openVideo(url) {
      const popup = document.getElementById("videoPopup");
      const vid = document.getElementById("popupVideo");
      vid.src = url;
      popup.style.display = "flex";
    }
    document.getElementById("videoPopup").onclick = function(e){
      if (e.target === this) {
        this.style.display = "none";
        document.getElementById("popupVideo").pause();
      }
    };

    /* ------------------------------
       ì¢‹ì•„ìš”
    ------------------------------ */
    function toggleLike(i) {
      const uploads = JSON.parse(localStorage.getItem("uploads") || "[]");

      // ì¢‹ì•„ìš” ìƒíƒœ ë°˜ì „
      uploads[i].liked = !uploads[i].liked;

      // ì¢‹ì•„ìš” ìˆ˜ ì¦ê°€/ê°ì†Œ
      if (!uploads[i].likes) uploads[i].likes = 0;
      uploads[i].likes = uploads[i].liked ? uploads[i].likes + 1 : uploads[i].likes - 1;
      if (uploads[i].likes < 0) uploads[i].likes = 0;  // ìŒìˆ˜ ë°©ì§€

      // ì €ì¥
      localStorage.setItem("uploads", JSON.stringify(uploads));

      // UI ì—…ë°ì´íŠ¸
      loadAlbum();
    }

        /* ------------------------------
       TTS: ì—…ë¡œë“œ ì¹´ë“œ ì½ì–´ì£¼ê¸°
    ------------------------------ */
    function readUpload(i) {
      const uploads = JSON.parse(localStorage.getItem("uploads") || "[]");
      const item = uploads[i];
      if (!item) return;

      const title = item.title || "ì œëª© ì—†ìŒ";
      const placeSentence = item.place ? `ì´¬ì˜ ì¥ì†ŒëŠ” ${item.place}ì…ë‹ˆë‹¤.` : "";

      const tagsArray = item.tags || [];
      const tagsSentence = tagsArray.length > 0
        ? `íƒœê·¸ëŠ” ${tagsArray.join(", ")} ì…ë‹ˆë‹¤.`
        : "";

      const text = `${title}. ${placeSentence} ${tagsSentence}`.trim();
      speakText(text);
    }

    /* ------------------------------
       ìˆ˜ì • íŒì—…
    ------------------------------ */
    function openEdit(i) {
      editIndex = i;
      const uploads = JSON.parse(localStorage.getItem("uploads") || "[]");
      const item = uploads[i];

      document.getElementById("editTitle").value = item.title;
      document.getElementById("editPlace").value = item.place;
      document.getElementById("editTags").value = item.tags.map(t => `#${t}`).join(" ");


      document.getElementById("editPopup").style.display = "block";
    }

    function closeEdit() {
      document.getElementById("editPopup").style.display = "none";
    }

    function saveEdit() {
      const uploads = JSON.parse(localStorage.getItem("uploads") || "[]");

      uploads[editIndex].title = document.getElementById("editTitle").value;
      uploads[editIndex].place = document.getElementById("editPlace").value;
      uploads[editIndex].tags = document
        .getElementById("editTags")
        .value
        .split(/[\s#]+/)
        .filter(t => t !== "");


      // â­ íŒŒì¼ êµì²´ ì²˜ë¦¬
      const newFile = document.getElementById("editFile").files[0];
      if (newFile) {
          const reader = new FileReader();
          reader.onload = function (e) {
              uploads[editIndex].url = e.target.result;
              uploads[editIndex].type = newFile.type.startsWith("video") ? "video" : "image";

              localStorage.setItem("uploads", JSON.stringify(uploads));
              closeEdit();
              loadAlbum();
          };
          reader.readAsDataURL(newFile);
          return; // ì•„ë˜ ì½”ë“œ ì‹¤í–‰ ë°©ì§€
      }


      localStorage.setItem("uploads", JSON.stringify(uploads));
      closeEdit();
      loadAlbum();
    }

    /* ------------------------------
       ì‚­ì œ
    ------------------------------ */
    function deleteItem(i) {
      if (!confirm("ì‚­ì œí• ê¹Œìš”?")) return;

      const uploads = JSON.parse(localStorage.getItem("uploads") || "[]");
      uploads.splice(i, 1);
      localStorage.setItem("uploads", JSON.stringify(uploads));
      loadAlbum();
    }

    /* ------------------------------
       ì´ˆê¸° ì‹¤í–‰
    ------------------------------ */
    loadProfileSummary();
    loadAlbum();
    loadQOTD();
  </script>
  <script>
    function speakText(text) {
      if (!('speechSynthesis' in window)) {
        alert('ì´ ë¸Œë¼ìš°ì €ëŠ” ìŒì„± ì¶œë ¥(TTS)ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
        return;
      }
      // ì´ì „ì— ì½ë˜ ê±° ìˆìœ¼ë©´ ì •ì§€
      window.speechSynthesis.cancel();

      const utter = new SpeechSynthesisUtterance(text);
      utter.lang = 'ko-KR'; // í•œêµ­ì–´
      window.speechSynthesis.speak(utter);
    }
  </script>

</body>
</html>
